var Guitar=function(){function t(t){this.chordPatterns=[{type:"clamp",fret:"isNumber:isInteger",string:"isNumber:isInteger:inStringRange"},{type:"barre",fret:"isNumber:isInteger",barre:{from:"isNumber:isInteger:inStringRange",to:"isNumber:isInteger:inStringRange"}}],this.fretNum=3,this.chordFirstFret=null,this.chord=null,this.stringNum=6,this.statusStringList=[null,"open","closed"],this.statusString=null,this._setData(t)}function i(i,r){this.elementId=i,this.element=document.getElementById(this.elementId),this.svg=null,this.svgWidth=215,this.svgHeigth=112,this.riffStartX=25,this.riffStartY=6,this.riffWidth=180,this.riffHeight=100,this.stringWidth=1,this.stringVerticalMargin=20,this.stringHorizontalMargin=60,this.statusStringStartX=10,this.radiusStatusString=5,this.radiusClampString=5,this.colors={white:"rgb(255, 255, 255)",black:"rgb(0, 0, 0)"},this.fontFamily="Tahoma",this.fontSize=16;var s=new t(r);this.data=s.getData()}var r={url:"http://www.w3.org/2000/svg",getNode:function(t,i){var r=document.createElementNS(this.url,t);for(var s in i)r.setAttributeNS(null,s,i[s]);return r}};return t.prototype._setData=function(t){if("object"!=typeof t)throw new Error("Wrong options type");"statusString"in t&&(this.statusString=this._validateStringStatus(t.statusString)),"chord"in t&&(this.chord=this._validateChord(t.chord),this.chordFirstFret=this.getFirstFretOfChord(),this._filterChord())},t.prototype._validateStringStatus=function(t){if(!Array.isArray(t))throw new Error("String status must be array");if(t.length!=this.stringNum)throw new Error("Number of string must be equal "+this.stringNum);for(var i=0;i<t.length;i++)if(-1==this.statusStringList.indexOf(t[i]))throw new Error("Wrong string status");return t},t.prototype._validateChord=function(t){for(var i=0,r=t.length;i<r;i++){for(var s=!1,h=0,a=this.chordPatterns.length;h<a;h++)this._compareWithPattern(t[i],this.chordPatterns[h])&&(t[i].type=this.chordPatterns[h].type,s=!0);if(!s)throw new Error("Wrong chord data")}return t},t.prototype._filterChord=function(){this.chord=this.chord.filter(function(t){if(t.fret<this.chordFirstFret+this.fretNum)return t},this)},t.prototype._compareWithPattern=function(t,i){for(var r in i)if("type"!=r){if("object"==typeof t[r]&&typeof i[r]==typeof i[r])return this._compareWithPattern(t[r],i[r]);if(!t.hasOwnProperty(r))return!1;for(var s=i[r].split(":"),h=0,a=s.length;h<a;h++)if(!this["_"+s[h]](t[r]))return!1}return!0},t.prototype._isNumber=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},t.prototype._isInteger=function(t){return(0^t)===t},t.prototype._inStringRange=function(t){return t>=1&&t<=this.stringNum},t.prototype.getFirstFretOfChord=function(){for(var t=null,i=0,r=this.chord.length;i<r;i++)(this.chord[i].fret<t||null==t)&&(t=this.chord[i].fret);return t},t.prototype.getData=function(){return{statusString:this.statusString,chord:this.chord,firstFret:this.chordFirstFret,stringNum:this.stringNum}},i.prototype._drawSvg=function(){this.svg=r.getNode("svg",{width:this.svgWidth,height:this.svgHeigth})},i.prototype._drawRiff=function(){this.svg.appendChild(r.getNode("rect",{x:this.riffStartX,y:this.riffStartY,height:this.riffHeight,width:this.riffWidth,stroke:this.colors.black,"stroke-width":this.stringWidth,fill:this.colors.white}));for(var t=this.stringHorizontalMargin+this.riffStartX;t<=this.riffWidth;t+=this.stringHorizontalMargin)this.svg.appendChild(r.getNode("line",{x1:t,y1:this.riffStartY,x2:t,y2:this.riffHeight+this.riffStartY,stroke:this.colors.black,"stroke-width":this.stringWidth}));for(var t=this.stringVerticalMargin+this.riffStartY;t<=this.riffHeight;t+=this.stringVerticalMargin)this.svg.appendChild(r.getNode("line",{x1:this.riffStartX,y1:t,x2:this.riffStartX+this.riffWidth,y2:t,stroke:this.colors.black,"stroke-width":this.stringWidth}))},i.prototype._drawStringStatus=function(){for(var t=0,i=this.data.statusString.length;t<i;t++)switch(this.data.statusString[t]){case"open":this.svg.appendChild(r.getNode("circle",{cx:this.statusStringStartX+this.radiusStatusString,cy:this.riffStartY+this.stringVerticalMargin*t,r:this.radiusStatusString,stroke:this.colors.black,"stroke-width":this.stringWidth,fill:this.colors.white}));break;case"closed":this.svg.appendChild(r.getNode("line",{x1:this.statusStringStartX,y1:this.riffStartY-this.radiusStatusString+this.stringVerticalMargin*t,x2:this.statusStringStartX+2*this.radiusStatusString,y2:this.riffStartY+this.radiusStatusString+this.stringVerticalMargin*t,stroke:this.colors.black,"stroke-width":this.stringWidth})),this.svg.appendChild(r.getNode("line",{x1:this.statusStringStartX+2*this.radiusStatusString,y1:this.riffStartY-this.radiusStatusString+this.stringVerticalMargin*t,x2:this.statusStringStartX,y2:this.riffStartY+this.radiusStatusString+this.stringVerticalMargin*t,stroke:this.colors.black,"stroke-width":this.stringWidth}))}},i.prototype._drawClampString=function(t,i){this.svg.appendChild(r.getNode("circle",{cx:this.riffStartX+this.stringHorizontalMargin/2+this.stringHorizontalMargin*(t-this.data.firstFret),cy:this.riffStartY+this.stringVerticalMargin*(i-1),r:this.radiusClampString,stroke:this.colors.black,"stroke-width":this.stringWidth,fill:this.colors.black}))},i.prototype._drawBarre=function(t,i,s){if(this._drawClampString(t,i),this._drawClampString(t,s),s<i){var h=s;s=i,i=h}this.svg.appendChild(r.getNode("rect",{x:this.riffStartX+this.stringHorizontalMargin/2-this.radiusClampString+this.stringHorizontalMargin*(t-this.data.firstFret),y:this.riffStartY+this.stringVerticalMargin*(i-1),height:this.stringVerticalMargin*(s-1),width:2*this.radiusClampString,stroke:this.colors.black,"stroke-width":this.stringWidth,fill:this.colors.black}))},i.prototype._drawFretNumber=function(t){var i=r.getNode("text",{x:this.riffStartX,y:this.riffStartY+this.data.stringNum*this.stringVerticalMargin,"font-family":this.fontFamily,fill:this.colors.black});i.textContent=t,this.svg.appendChild(i)},i.prototype.drawChord=function(){this.data.firstFret>1&&(this.svgHeigth=this.svgHeigth+this.fontSize),this._drawSvg(),this._drawRiff(),this._drawStringStatus();for(var t=0,i=this.data.chord.length;t<i;t++)switch(this.data.chord[t].type){case"clamp":this._drawClampString(this.data.chord[t].fret,this.data.chord[t].string);break;case"barre":this._drawBarre(this.data.chord[t].fret,this.data.chord[t].barre.from,this.data.chord[t].barre.to)}this.data.firstFret>1&&this._drawFretNumber(this.data.firstFret),this.element.appendChild(this.svg)},{chord:function(t,r){new i(t,r).drawChord(t)}}}();